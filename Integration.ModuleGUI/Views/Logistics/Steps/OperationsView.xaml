<UserControl x:Class="Integration.ModuleGUI.Views.OperationsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:i = "http://schemas.microsoft.com/expression/2010/interactivity"
             xmlns:local="clr-namespace:Integration.ModuleGUI.Views"
             xmlns:vm="clr-namespace:Integration.ModuleGUI.ViewModels"
             xmlns:partialViews="clr-namespace:Integration.PartialViews.Views;assembly=Integration.PartialViews"
             xmlns:Controls="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:wnd="http://metro.mahapps.com/winfx/xaml/simplechildwindow"
             mc:Ignorable="d" 
             xmlns:charts="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             xmlns:dsx="clr-namespace:DsxGridCtrl;assembly=DsxGridCtrl"
             xmlns:prism="http://prismlibrary.com/"
             prism:ViewModelLocator.AutoWireViewModel="True">

    <UserControl.Resources>
        <Style TargetType="charts:PieChart">
            <Setter Property="Height" Value="420"/>
            <Setter Property="Width" Value="650"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="Thin"/>
            <Setter Property="LegendLocation"  Value="Right"/>
            <Setter Property="ClipToBounds" Value="True"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Hoverable" Value="True"/>
            <Setter Property="HoverPushOut" Value="10"/>
            <Setter Property="DataClickCommand" Value="{Binding ClickDataCommand}"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
        </Style>
    </UserControl.Resources>

    
    
    <Grid>

        <Grid.ColumnDefinitions>
            <ColumnDefinition/>
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>

        <Controls:MetroAnimatedSingleRowTabControl Grid.ColumnSpan="2">
            <TabItem Header="Операции">
                <StackPanel>
                    <Button Content="Затраты на транспортное обеспечение" Margin="10" Padding="10"
                            Command="{Binding WriteTotalStatisticsInFileCommand}"
                            Style="{StaticResource LargeBlueBtn}"
                            ToolTip="Подсчёт расхода топлива и затрат, общего пробега и моточасов наработки"/>
                    <Button Content="Аудит пробегов" Margin="10" Padding="10"
                            Command="{Binding CheckDifferenceOfTotalSpeedCommand}"
                            Style="{StaticResource LargeBlueBtn}"
                            ToolTip="Сравнение данных по пробегу из системы SAP и Wialon"/>
                </StackPanel>
            </TabItem>

            <TabItem Header="Сводка по SAP">
                <Grid>

                    <Button Margin="10" Padding="10"
                            Content="Инициализация"
                            Command="{Binding ShowDetailsOnSAPCommand}"
                            ToolTip="Быстрая сводка по путевым листам из системы SAP">
                        <Button.Style>
                            <Style BasedOn="{StaticResource LargeBlueBtn}" TargetType="Button">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ModuleData.Vehicles}" Value="{x:Null}">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <Grid VirtualizingPanel.VirtualizationMode="Recycling"
                          VirtualizingPanel.IsVirtualizing="True"
                          VirtualizingPanel.IsContainerVirtualizable="True">
                        <StackPanel>
                            
                                <Button Width="56" Height="56"
                                        HorizontalAlignment="Left" 
                                        VerticalAlignment="Top"
                                        Padding="12" Margin="10" 
                                        Style="{StaticResource MahApps.Metro.Styles.MetroCircleButtonStyle}"
                                        Command="{Binding ShowDetailsOnSAPCommand}"
                                        ToolTip="Обновить данные">
                                <Rectangle Width="28" Height="28" Fill="{Binding Path=Foreground, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Button}}}">
                                    <Rectangle.OpacityMask>
                                        <VisualBrush Stretch="Fill" Visual="{DynamicResource appbar_refresh}" />
                                    </Rectangle.OpacityMask>
                                </Rectangle>
                            </Button>

                            <!--<ToggleButton IsChecked="{Binding SimpleSelection}"
                                    Width="56"
              Height="56"
              HorizontalAlignment="Left" 
                            VerticalAlignment="Top"
                            Padding="12" Margin="10 70 10 10" 
              Style="{StaticResource MahApps.Metro.Styles.MetroCircleToggleButtonStyle}">
                                <Rectangle Width="28"
               Height="28"
               Fill="{Binding Path=Foreground, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ToggleButton}}}">
                                    <Rectangle.OpacityMask>
                                        <VisualBrush Stretch="Fill"
                         Visual="{DynamicResource appbar_city}"/>
                                    </Rectangle.OpacityMask>
                                </Rectangle>
                            </ToggleButton>-->
                        </StackPanel>

                        <Controls:MetroAnimatedSingleRowTabControl TabStripPlacement="Right"
                                                               TabStripMargin="12 5"
                                                               IsTabStop="True"
                                                               HorizontalAlignment="Right">
                        <Controls:MetroTabItem Header="Пробег" HorizontalContentAlignment="Stretch">

                                <WrapPanel>
                                    <Grid>
                                        <StackPanel>
                                            <TextBlock Text="Топ 10 по пробегу (по ПЛ)" 
                                               TextWrapping="WrapWithOverflow" 
                                               TextAlignment="Center"
                                               Margin="10"
                                               Style="{DynamicResource NormalHeaderWithEffect}"/>
                                            <charts:PieChart HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                                         Series="{Binding CarMileageStatisticsSAP}">
                                                <charts:PieChart.DataTooltip>
                                                    <charts:DefaultTooltip BulletSize="20" FontSize="13" IsWrapped="False" SelectionMode="OnlySender"/>
                                                </charts:PieChart.DataTooltip>
                                            </charts:PieChart>

                                            <StackPanel.Style>
                                                <Style TargetType="{x:Type StackPanel}">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding CarMileageStatisticsSAP}" Value="{x:Null}">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </StackPanel.Style>
                                        </StackPanel>

                                        <Button Grid.Column="1" Width="22" Height="22"
                                            HorizontalAlignment="Right" 
                                            VerticalAlignment="Top" 
                                            ToolTipService.HasDropShadow="True"
                                            ToolTipService.InitialShowDelay="100"
                                            Padding="4" Margin="10" ClickMode="Hover"
                                            Style="{StaticResource MahApps.Metro.Styles.MetroCircleButtonStyle}">
                                            <Rectangle Width="5" Height="10" Fill="{Binding Path=Foreground, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Button}}}">
                                                <Rectangle.OpacityMask>
                                                    <VisualBrush Stretch="Fill" Visual="{DynamicResource appbar_information}" />
                                                </Rectangle.OpacityMask>
                                            </Rectangle>
                                            <Button.ToolTip>
                                                <ToolTip>
                                                    <StackPanel>
                                                        <TextBlock Text="ТС что находятся в обеих списках" TextAlignment="Center"
                                                                   Margin="8 5 8 18" TextWrapping="WrapWithOverflow" 
                                                                   Style="{DynamicResource SmallHeader}"/>
                                                        <ListView ItemsSource="{Binding CommonCars}"/>
                                                    </StackPanel>
                                                </ToolTip>
                                            </Button.ToolTip>
                                        </Button>
                                    </Grid>

                                    <StackPanel>
                                        <TextBlock Text="Топ 10 по среднему пробегу за поездку (по ПЛ)" 
                                               TextWrapping="WrapWithOverflow" 
                                               TextAlignment="Center"
                                               Margin="10"
                                               Style="{DynamicResource NormalHeaderWithEffect}"/>
                                        <charts:PieChart HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                                         Series="{Binding CarAverageMileageByTripStatisticsSAP}">
                                            <charts:PieChart.DataTooltip>
                                                <charts:DefaultTooltip BulletSize="20" FontSize="13" IsWrapped="False"/>
                                            </charts:PieChart.DataTooltip>
                                        </charts:PieChart>

                                        <StackPanel.Style>
                                            <Style TargetType="{x:Type StackPanel}">
                                                <Setter Property="Visibility" Value="Visible"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding CarAverageMileageByTripStatisticsSAP}" Value="{x:Null}">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </StackPanel.Style>
                                    </StackPanel>
                                </WrapPanel>

                            </Controls:MetroTabItem>
                        
                        <Controls:MetroTabItem Header="Водители"/>
                    </Controls:MetroAnimatedSingleRowTabControl>

                        <Grid.Style>
                            <Style TargetType="{x:Type Grid}">
                                <Setter Property="Visibility" Value="Visible"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ModuleData.Vehicles}" Value="{x:Null}">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>
                        
                    </Grid>
                    
                    

                    <!--<Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="100"/>
                        </Grid.ColumnDefinitions>

                        --><!--<dsx:DsxDataGrid ItemsSource="{Binding ModuleData.Vehicles}"
                                         Margin="5"
                                         AllowCheckAnyTime="True"
                                         SortField="StateNumber"
                                         HorizontalGridLinesIsVisible="True"
                                         HorizontalScrollbarVisibility="Auto"
                                         VerticalScrollbarVisibility="Auto"
                                         VerticalGridLinesIsVisible="{Binding GridConfiguration.VerticalGridLinesIsVisible}"
                                         CellAdornerIsVisible="True"
                                         CellEditingIsEnabled="False"
                                         FooterVisibility="Auto"
                                         FilterVisibility="Auto"
                                         ItemFixHeight="20"
                                         FilterHeight="40" MaxHeight="460"
                                         IsVirtualizing="True">

                            <dsx:DsxDataGrid.Style>
                                <Style TargetType="dsx:DsxDataGrid">
                                    <Setter Property="HeaderVisibility" Value="Visible"/>
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding GridConfiguration.HeaderIsVisible}" Value="False">
                                            <Setter Property="HeaderVisibility" Value="Collapsed"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding ModuleData.Vehicles}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </dsx:DsxDataGrid.Style>

                            <dsx:DsxDataGrid.Columns>
                                <dsx:DsxColumn FieldName="StateNumber"
                                               DisplayMemberBinding="{Binding Path=StateNumber}"
                                               Header="Гос.номер" Width="95"
                                               IsSizable="False" IsSortable="True"
                                               ViewType="Text" FilterType="TextBox" 
                                               FooterType="None" EditType="None"
                                               FilterCriteria="Contains"
                                               CellFontWeight="DemiBold"
                                               CellForeground="DarkBlue"
                                               CellHAlign="Center"/>

                                <dsx:DsxColumn FieldName="UnitModel"
                                               DisplayMemberBinding="{Binding Path=UnitModel}"
                                               Header="Модель" Width="180" 
                                               IsSizable="True" ViewType="Text" 
                                               FilterType="TextBox"  EditType="None" 
                                               CellHAlign="Left"/>

                                <dsx:DsxColumn FieldName="Type" 
                                               DisplayMemberBinding="{Binding Path=Type}"
                                               Header="Тип" Width="180" 
                                               IsSizable="True" ViewType="Text" 
                                               FilterType="TextBox" EditType="None" 
                                               CellHAlign="Left"/>

                                <dsx:DsxColumn FieldName="Department" 
                                               DisplayMemberBinding="{Binding Path=Department}"
                                               Header="Службы/отделы" Width="180"
                                               IsSizable="True" IsSortable="True"
                                               ViewType="Text" FilterType="TextBox" 
                                               EditType="None"
                                               CellHAlign="Left"/>

                                <dsx:DsxColumn FieldName="StructureName" 
                                               DisplayMemberBinding="{Binding Path=StructureName}"
                                               Header="Структурные подразделения" Width="115" 
                                               IsSizable="True" ViewType="Text" 
                                               FilterType="TextBox" EditType="TextBox" 
                                               CellHAlign="Left"/>

                                <dsx:DsxColumn FieldName="CountTrips" 
                                               DisplayMemberBinding="{Binding Path=CountTrips}"
                                               Header="К-во поездок" Width="100" 
                                               IsSizable="True" ViewType="Integer"
                                               FilterType="TextBox"  EditType="TextBox"  
                                               FilterCriteria="GreaterOrEqual"
                                               CellHAlign="Left"/>

                                <dsx:DsxColumn FieldName="TripResulted" 
                                               DisplayMemberBinding="{Binding TripResulted.TotalMileage}"
                                               Header="Всего км." Width="70" 
                                               IsSizable="True" ViewType="Text"
                                               FilterType="None"  EditType="TextBox"
                                               CellHAlign="Left"/>

                            </dsx:DsxDataGrid.Columns>

                        </dsx:DsxDataGrid>

                        <partialViews:GridConfigurationView Grid.Column="1">
                            <partialViews:GridConfigurationView.Style>
                                <Style TargetType="{x:Type UserControl}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ModuleData.Vehicles}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </partialViews:GridConfigurationView.Style>
                        </partialViews:GridConfigurationView>--><!--
                    </Grid>-->
                </Grid>
            </TabItem>
        </Controls:MetroAnimatedSingleRowTabControl>
    </Grid>
</UserControl>
